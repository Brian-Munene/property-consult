<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Status - Property Consult Limited</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .payment-status {
            max-width: 600px;
            margin: 50px auto;
            padding: 2rem;
            text-align: center;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-icon {
            font-size: 48px;
            margin-bottom: 1rem;
        }
        .success { color: #25d366; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <a href="index.html" class="back-button">Home</a>
            <h1 class="logo">Property Consult Limited</h1>
        </div>
    </header>

    <div class="payment-status">
        <div id="statusContent" role="status" aria-live="polite">
            <div class="status-icon">⏳</div>
            <h2>Processing Payment</h2>
            <p>Please wait while we verify your payment...</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderTrackingId = urlParams.get('pesapal_transaction_tracking_id');
            const orderMerchantReference = urlParams.get('pesapal_merchant_reference');
            const orderNotificationType = urlParams.get('pesapal_notification_type');

if (!orderTrackingId || !orderMerchantReference) {
    showError('Payment verification failed: Missing transaction reference. Please contact support with your payment details.');
    return;
}

            try {
 const pesapal = new PesapalAPI(
     window.pesapalConfig.consumer_key,
     window.pesapalConfig.consumer_secret,
     window.pesapalConfig.testing
 );

                const paymentStatus = await pesapal.checkPaymentStatus(
                    orderMerchantReference,
                    orderTrackingId
                );

                if (paymentStatus.status === 'COMPLETED') {
                    showSuccess();
                } else {
                    showError('Payment was not completed');
                }
            } catch (error) {
                console.error('Error verifying payment:', error);
                showError('Failed to verify payment');
            }
        });

        function showSuccess() {
            const statusContent = document.getElementById('statusContent');
            statusContent.innerHTML = `
                <div class="status-icon success">✓</div>
                <h2>Payment Successful</h2>
                <p>Your payment has been processed successfully.</p>
                <p>You will receive a confirmation message shortly.</p>
                <a href="index.html" class="btn" style="display: inline-block; margin-top: 1rem;">Return Home</a>
            `;
        }

        function showError(message) {
            const statusContent = document.getElementById('statusContent');
            statusContent.innerHTML = `
                <div class="status-icon error">✗</div>
                <h2>Payment Failed</h2>
                <p>${message}</p>
                <a href="index.html" class="btn" style="display: inline-block; margin-top: 1rem;">Return Home</a>
            `;
        }
    </script>
            <!-- Floating Facebook Action Button -->
            <a id="fab-facebook" href="https://m.facebook.com/@propertyconsultnairobi/?hr=1&wtsid=rdr_0ihSS4ejxE7gTWrJg" target="_blank" rel="noopener noreferrer" aria-label="Visit our Facebook page">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <rect width="24" height="24" rx="4" fill="#1877F2"/>
                    <path d="M15.12 8.5H13.5C12.92 8.5 12.5 8.92 12.5 9.5V11.12H15.12L14.88 13.02H12.5V18H10.5V13.02H8.88V11.12H10.5V9.3C10.5 7.6 11.67 6.5 13.3 6.5H15.12V8.5Z" fill="white"/>
                </svg>
            </a>
</body>
</html>